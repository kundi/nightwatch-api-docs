<h1 id='search-api'>Search API</h1>
<p>The Search API is a feature in Nightwatch where you submit a search engine query to Nightwatch,
then Nightwatch performs a search engine query, gets the SERP, extracts data and enables you to
download it.</p>

<p>This feature is useful for scraping Google via Nightwatch&#39;s system and getting SERP data for
specified queries.</p>

<aside class="notice">
  This is a Nightwatch feature that is available only to accounts that have it enabled.
  If you want to enable it on your account, contact support at <a href="mailto:info@nightwatch.io">info@nightwatch.io</a>.
</aside>

<p>The Search API is used to perform on demand search requests using your allocated account credits.
Credits can be bought via an external form. Please contact <a href="mailto:info@nightwatch.io">support</a> if you want to buy more.
To check how many credits you have, check the <a href="#user">user</a> endpoint.</p>

<p>Every search request costs a certain amount of credits, depending on the request type.
You can learn more about it in our <a href="https://docs.nightwatch.io/article/91-nightwatch-api">docs</a> - check the
section under &quot;Partner API&quot; (this is a legacy name for Search API).</p>

<p>The searches are always performed asynchronously, and you can subscribe to them using the callback url that you&#39;ve provided to our support team.
Alternatively you can also poll a serach request until it is processed and the <code>done</code> flag is set to <code>true</code>.
You can also query search requests using the <code>custom_id</code> in place of the serach request id.</p>
<h2 id='list-search-requests'>List search requests</h2>
<p>Return a list of the 100 most recent search requests.</p>
<pre class="highlight shell tab-shell"><code>curl <span class="s1">'https://api.nightwatch.io/api/v1/partner/search_requests?access_token=ACCESS_TOKEN'</span> <span class="se">\\</span>
  -H <span class="s1">'Content-Type: application/json'</span>
</code></pre>
<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="w">  </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="s2">"engine"</span><span class="p">:</span><span class="w"> </span><span class="s2">"google"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"query"</span><span class="p">:</span><span class="w"> </span><span class="s2">"coffee shop"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"done"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="s2">"processed_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-08-27T20:02:00.000+02:00"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-08-27T20:01:00.000+02:00"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"results_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.com/results/search_request_1.json"</span><span class="w">
      </span><span class="s2">"google_gl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"us"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"google_hl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="s2">"location_text"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="s2">"location_criteria_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="s2">"instant"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="s2">"accuracy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"normal"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"custom_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="s2">"mobile"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">

</span></code></pre><h3 id='http-request'>HTTP Request</h3>
<p><code>GET https://api.nightwatch.io/api/v1/partner/search_requests?access_token=ACCESS_TOKEN</code></p>
<h2 id='show-search-request'>Show search request</h2><pre class="highlight shell tab-shell"><code>curl <span class="s1">'https://api.nightwatch.io/api/v1/partner/search_requests/REQUEST_ID?access_token=ACCESS_TOKEN'</span> <span class="se">\\</span>
  -H <span class="s1">'Content-Type: application/json'</span>
</code></pre>
<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="w">  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"engine"</span><span class="p">:</span><span class="w"> </span><span class="s2">"google"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"query"</span><span class="p">:</span><span class="w"> </span><span class="s2">"coffee shop"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"done"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"processed_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-08-27T20:02:00.000+02:00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-08-27T20:01:00.000+02:00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"results_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.com/results/search_request_1.json"</span><span class="w">
    </span><span class="s2">"google_gl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"us"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"google_hl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="s2">"location_text"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"location_criteria_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"instant"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"accuracy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"normal"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"custom_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"mobile"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">}</span><span class="w">

</span></code></pre><h3 id='http-request-2'>HTTP Request</h3>
<p><code>GET https://api.nightwatch.io/api/v1/partner/search_requests/REQUEST_ID?access_token=ACCESS_TOKEN</code></p>
<h3 id='url-parameters'>URL Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>custom_id</td>
<td>Set to true if you would like to query the search request by <code>custom_id</code> instead</td>
</tr>
</tbody></table>
<h2 id='make-a-search-request'>Make a search request</h2><pre class="highlight shell tab-shell"><code>curl <span class="s1">'https://api.nightwatch.io/api/v1/partner/search_requests?access_token=ACCESS_TOKEN'</span> <span class="se">\\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\\</span>
  -X POST <span class="se">\\</span>
  -d <span class="s1">'{
        "engine": "google",
        "query": "coffee shop",
        "google_hl": "en",
        "google_gl": "us",
        "location_criteria_id": 1014221,
        "instant": true,
        "mobile": false,
        "accuracy": "normal"
      }'</span>
</code></pre>
<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="w">  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"engine"</span><span class="p">:</span><span class="w"> </span><span class="s2">"google"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"query"</span><span class="p">:</span><span class="w"> </span><span class="s2">"coffee shop"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"done"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="err">once</span><span class="w"> </span><span class="err">processed</span><span class="w">
    </span><span class="s2">"processed_at"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">set</span><span class="w"> </span><span class="err">once</span><span class="w"> </span><span class="err">processed</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-08-27T20:02:00.000+02:00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"results_url"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">url</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">SERP</span><span class="w"> </span><span class="err">JSON</span><span class="w"> </span><span class="err">once</span><span class="w"> </span><span class="err">processed</span><span class="w">
    </span><span class="s2">"google_gl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"us"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"google_hl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="s2">"location_text"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"location_criteria_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"instant"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"accuracy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"normal"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"custom_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"mobile"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>When the search request is performed, you will receive the <a href="#get-serp-data">SERP JSON</a> on your configured callback URL like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">search</span><span class="w"> </span><span class="err">request</span><span class="w"> </span><span class="err">id</span><span class="w">
  </span><span class="s2">"keyword"</span><span class="p">:</span><span class="s2">"coffee shop"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"engine"</span><span class="p">:</span><span class="s2">"google"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"rank_time"</span><span class="p">:</span><span class="s2">"2019-08-25T03:11:51.614409Z"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"rank_date"</span><span class="p">:</span><span class="s2">"2019-08-25"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"locale"</span><span class="p">:</span><span class="s2">"en"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"data_center"</span><span class="p">:</span><span class="s2">"us"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"location"</span><span class="p">:</span><span class="err">nil</span><span class="p">,</span><span class="w">
  </span><span class="s2">"total_number_of_results"</span><span class="p">:</span><span class="mi">160000</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serp"</span><span class="p">:{</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="s2">"local_pack"</span><span class="p">:{</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="s2">"local_image_carousel"</span><span class="p">:{</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="s2">"knowledge_panel"</span><span class="p">:{</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="s2">"featured_snippets"</span><span class="p">:{</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="p">},</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='http-request-3'>HTTP Request</h3>
<p><code>POST https://api.nightwatch.io/api/v1/partner/search_requests?access_token=ACCESS_TOKEN</code></p>
<h3 id='parameters'>Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>engine*</td>
<td>Search engine (google, places, bing, yahoo, duckduckgo, youtube)</td>
</tr>
<tr>
<td>query*</td>
<td>Keyword query string</td>
</tr>
<tr>
<td>google_hl</td>
<td>Language (e.g. en)</td>
</tr>
<tr>
<td>google_gl</td>
<td>Location (e.g. us)</td>
</tr>
<tr>
<td>location_criteria_id</td>
<td>Search location Criteria ID (see https://developers.google.com/ad-exchange/rtb/geotargeting) - Google only</td>
</tr>
<tr>
<td>custom_id</td>
<td>Custom ID used in your system</td>
</tr>
<tr>
<td>mobile</td>
<td>Mobile search (true/false) - Google only</td>
</tr>
<tr>
<td>instant*</td>
<td>Instant processing - true (process as soon as possible) / false (process when available)</td>
</tr>
<tr>
<td>accuracy*</td>
<td>Accuracy - normal (100 results per page) / high (10 results per page concatenated)</td>
</tr>
</tbody></table>

<p>Parameters marked with * are mandatory.</p>
<h2 id='make-search-requests-batch'>Make search requests (batch)</h2>
<p>You can create multiple search requests in batches of max 100.</p>
<pre class="highlight shell tab-shell"><code>curl <span class="s1">'https://api.nightwatch.io/api/v1/partner/search_requests?access_token=ACCESS_TOKEN'</span> <span class="se">\\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\\</span>
  -X POST <span class="se">\\</span>
  -d <span class="s1">'{
        "batch": [
          {
            "engine": "google",
            "query": "coffee shop",
            "google_hl": "en",
            "google_gl": "us",
            "location_criteria_id": 1014221,
            "instant": true,
            "mobile": false,
            "accuracy": "normal"
          },
          {
            "engine": "google",
            "query": "diner",
            "google_hl": "en",
            "google_gl": "us",
            "location_criteria_id": 1014221,
            "instant": true,
            "mobile": false,
            "accuracy": "normal"
          },
        ]
      }'</span>
</code></pre>
<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"engine"</span><span class="p">:</span><span class="w"> </span><span class="s2">"google"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"query"</span><span class="p">:</span><span class="w"> </span><span class="s2">"coffee shop"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"done"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="err">once</span><span class="w"> </span><span class="err">processed</span><span class="w">
    </span><span class="s2">"processed_at"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">set</span><span class="w"> </span><span class="err">once</span><span class="w"> </span><span class="err">processed</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-08-27T20:02:00.000+02:00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"results_url"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">url</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">SERP</span><span class="w"> </span><span class="err">JSON</span><span class="w"> </span><span class="err">once</span><span class="w"> </span><span class="err">processed</span><span class="w">
    </span><span class="s2">"google_gl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"us"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"google_hl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="s2">"location_text"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"location_criteria_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"instant"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"accuracy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"normal"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"custom_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"mobile"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"engine"</span><span class="p">:</span><span class="w"> </span><span class="s2">"google"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"query"</span><span class="p">:</span><span class="w"> </span><span class="s2">"diner"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"done"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="err">once</span><span class="w"> </span><span class="err">processed</span><span class="w">
    </span><span class="s2">"processed_at"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">set</span><span class="w"> </span><span class="err">once</span><span class="w"> </span><span class="err">processed</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-08-27T20:02:00.000+02:00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"results_url"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">url</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">SERP</span><span class="w"> </span><span class="err">JSON</span><span class="w"> </span><span class="err">once</span><span class="w"> </span><span class="err">processed</span><span class="w">
    </span><span class="s2">"google_gl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"us"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"google_hl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="s2">"location_text"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"location_criteria_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"instant"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"accuracy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"normal"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"custom_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"mobile"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="err">//</span><span class="w"> </span><span class="err">...</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre><h3 id='http-request-4'>HTTP Request</h3>
<p><code>POST https://api.nightwatch.io/api/v1/partner/search_requests?access_token=ACCESS_TOKEN</code></p>
<h3 id='parameters-2'>Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>batch*</td>
<td>A list of search requests to perform (max 100). See <a href="#make-a-search-request">search request</a> params.</td>
</tr>
</tbody></table>

<p>Parameters marked with * are mandatory.</p>
